// Generated by CoffeeScript 1.12.7
(function() {
  angular.module('tmsApp', ['ngRoute']).config([
    '$routeProvider', function($routeProvider) {
      return $routeProvider.when('/login', {
        templateUrl: '/app/login/index.html',
        controller: 'LoginCtrl'
      }).when('/register', {
        templateUrl: '/app/register/index.html',
        controller: 'RegisterCtrl'
      }).when('/', {
        templateUrl: '/app/index/index.html',
        controller: 'IndexCtrl'
      });
    }
  ]).run([
    '$location', '$http', '$route', function($location, $http, $route) {
      var token;
      token = localStorage.getItem('x-token');
      if (token) {
        return $http.post("{" + Tms.apiAddress + "/api/user/autologin}", {
          token: token
        }).then(function(res) {
          if (res.data === true) {
            $http.defaults.headers.common['x-token'] = token;
            localStorage.setItem('x-token', token);
            return $route.reload();
          } else {
            return $location.path('/login').replace();
          }
        }, function() {
          return $location.path('/login').replace();
        });
      } else {
        return $location.path('/login').replace();
      }
    }
  ]);

}).call(this);

//# sourceMappingURL=index.js.map
;
// Generated by CoffeeScript 1.10.0
(function() {
  angular.module('tmsApp').factory('tmsUtil', [
    function() {
      var processHttpError;
      processHttpError = function(res) {
        var data;
        data = res.data;
        if (data.message) {
          return alert(data.message);
        }
      };
      return {
        processHttpError: processHttpError
      };
    }
  ]);

}).call(this);

//# sourceMappingURL=tmsUtil.js.map
;
// Generated by CoffeeScript 1.12.7
(function() {
  angular.module('tmsApp').controller('LoginCtrl', [
    '$scope', '$location', '$http', 'tmsUtil', function($scope, $location, $http, tmsUtil) {
      $scope.userEntity = {
        username: '',
        password: '',
        rememberMe: false
      };
      return $scope.doLogin = function() {
        var init;
        $http.post(Tms.apiAddress + "/api/user/login", {
          username: $scope.userEntity.username,
          password: $scope.userEntity.password
        }).then(function(res) {
          var token;
          if ($scope.userEntity.rememberMe) {
            localStorage.setItem('username', $scope.userEntity.username);
          } else {
            localStorage.removeItem('username');
          }
          token = res.data.token;
          $http.defaults.headers.common['x-token'] = token;
          localStorage.setItem('x-token', token);
          return $location.path('/').replace();
        }, tmsUtil.processHttpError);
        return init = function() {
          var username;
          username = localStorage.getItem('username');
          if (username) {
            $scope.userEntity.rememberMe = true;
            $scope.userEntity.username = username;
          }
          return init();
        };
      };
    }
  ]);

}).call(this);

//# sourceMappingURL=loginCtrl.js.map
;
// Generated by CoffeeScript 1.12.7
(function() {
  angular.module('tmsApp').controller('IndexCtrl', [
    '$scope', '$location', '$http', 'tmsUtil', function($scope, $location, $http, tmsUtil) {
      var init;
      $scope.task = {
        taskName: ''
      };
      $scope.taskList = [];
      init = function() {
        console.log(2);
        return $http.get(Tms.apiAddress + "/api/task").then(function(res) {
          var tasks;
          tasks = res.data;
          return $scope.taskList = tasks;
        }, tmsUtil.processHttpError);
      };
      $scope.exit = function() {
        return $http.post(Tms.apiAddress + "/api/user/logout").then(function() {
          alert('注销成功！！！！');
          return $location.path('/login');
        }, tmsUtil.processHttpError);
      };
      $scope.changeTaskStatus = function(task) {
        return task.status = task.checked ? 'Finish' : 'InProgress';
      };
      $scope.deleteTask = function(task, index) {
        task.deleted = true;
        return $http.put(Tms.apiAddress + "/api/task", task).then(function() {
          return $scope.taskList.splice(index, 1);
        }, tmsUtil.processHttpError);
      };
      $scope.editTask = function(task) {
        task.isEditing = true;
        task.tempTaskName = task.taskName;
        $scope.cancelEditTask = function(task) {
          return task.isEditing = false;
        };
        return $scope.saveTask = function(task) {
          var oldTaskName;
          oldTaskName = task.taskName;
          task.taskName = task.tempTaskName;
          return $http.put(Tms.apiAddress + "/api/task", task).then(function(res) {
            return task.isEditing = false;
          }, function(res) {
            task.taskName = oldTaskName;
            return tmsUtil.processHttpError(res);
          });
        };
      };
      $scope.addTask = function() {
        var task;
        task = angular.copy($scope.task);
        return $http.post(Tms.apiAddress + "/api/task", {
          taskName: task.taskName
        }).then(function(res) {
          var newTask;
          newTask = res.data;
          task._id = newTask._id;
          return task.deleted = newTask.deleted;
        }, $scope.taskList.push(task), $scope.task.taskName = '', tmsUtil.processHttpError);
      };
      return init();
    }
  ]);

}).call(this);

//# sourceMappingURL=indexCtrl.js.map
;
// Generated by CoffeeScript 1.10.0
(function() {
  angular.module('tmsApp').controller('RegisterCtrl', [
    '$scope', '$http', '$location', 'tmsUtil', function($scope, $http, $location, tmsUtil) {
      $scope.userEntity = {
        username: '',
        password: '',
        password2: ''
      };
      return $scope.doRegister = function() {
        if ($scope.userEntity.password !== $scope.userEntity.password2) {
          return alert('两次密码不一致');
        }
        return $http.post(Tms.apiAddress + "/api/user/register", {
          username: $scope.userEntity.username,
          password: $scope.userEntity.password2
        }).then(function(res) {
          alert('注册成功！');
          return $location.path('/login');
        }, tmsUtil.processHttpError);
      };
    }
  ]);

}).call(this);

//# sourceMappingURL=registerCtrl.js.map
